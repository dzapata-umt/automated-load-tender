name: Processing Load Tendering

on:
  workflow_dispatch:
    inputs:
      pickupNumber:
        required: true
      totalRate:
        required: true
      runId:
        required: false

jobs:
  automated_process:
    environment: 'PROD'
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: 'npm'

      - name: Start Process
        env:
          SHIPPER_REFERENCE: ${{github.event.inputs.pickupNumber}}
          TOTAL_RATE: ${{ github.event.inputs.totalRate }}
          ACCOUNT_ID: ${{secrets.DITAT_ACCOUNT}}
          USERNAME: ${{secrets.USERNAME}}
          PASSWORD: ${{secrets.PASSWORD}}
          RUN_ID: ${{ github.event.inputs.runId }}
        run: |
          set -euo pipefail

          : "${SHIPPER_REFERENCE:?Missing pickupNumber}"
          : "${TOTAL_RATE:?Missing totalRate}"
          : "${ACCOUNT_ID:?Missing DITAT_ACCOUNT secret}"
          : "${USERNAME:?Missing USERNAME secret}"
          : "${PASSWORD:?Missing PASSWORD secret}"
          : "${RUN_ID:?Missing runId}"

          ./init.sh